## This folder contains all the source code and data for traffic estimation using particle filter. 

## Folders:
  - ./TrafficModel: This directory contains source code for the traffic model
  - ./FilterFuctions: This directory contains the particle filter source code
  - ./sensitivity_analysis: This directory contains the source code for the sensitivity analysis
  - ./DATA/: This directory saves all the data
  - ./Result: This directory saves all the estimation results. 
  
## How to run:
The results presented in the article is generated by following steps:
1. Finished all the simulations as described in [../Simulation/ folder](https://github.com/Lab-Work/AIMSUN_with_AVs/tree/master/Simulation)
2. Run [generate_measurement.py](https://github.com/Lab-Work/AIMSUN_with_AVs/blob/master/Estimation/generate_measurement.py) to copy and format the detection data in ../Simulation/detector_data/ to ./DATA/ folder in the correct format.
3. Run [generate_truestate.py](https://github.com/Lab-Work/AIMSUN_with_AVs/blob/master/Estimation/generate_truestate.py) to copy and format the true states in ../Simulation/true_states/ to ./DATA folder to the correct format.
4. Run [run_PF_estimations.py](https://github.com/Lab-Work/AIMSUN_with_AVs/blob/master/Estimation/run_PF_estimations.py) to run the particle filter. 
	- Make sure the parameters in run_PF_estimations.py are correctly set, including the FD parameters, and the scenario and seeds. 
	- It is suggested to run multiple instances of run_PF_estimations.py, each for a specific scenario and seed to reduce run time. 
	- The result will be saved in ./Result folder. Specify the directorySave in run_PF_estimations.py. 
5. Run [compute_plot_avg_error.py](https://github.com/Lab-Work/AIMSUN_with_AVs/blob/master/Estimation/compute_plot_avg_error.py) to:
	- Compute the average error of the estimation results. (For each scenario, the avg_error is computed as the average among all seeds of simulations and runs of PF)
	- Plot the average error. Specify the folder in compute_plot_avg_errro.py
6. Optional: Run [plot_estimation_results.py](https://github.com/Lab-Work/AIMSUN_with_AVs/blob/master/Estimation/plot_estimation_results.py) to visualize the estimation result. Specify the scenario, seed, run of PF, and directory in the script. 


## Sensitivity analysis:
The code related to sensitivity analysis are located in folder ./sensitivity_analysis. 
- Files with name "sa_est_*.py" are copies of "run_PF_estimation.py" where the FD parameters are perturbed differently in each copy.
- Files with name "sa_com_*.py" are copies of "compute_plot_avg_error.py" and each copy plots the result for each corresponding result. 
- Multiple copies are just to facilitate running multiple instances.
- It is not necessary to use the exact source code in ./sensitivity_analysis folder to perform the sensitivty analysis. One may simply modify  "run_PF_estimations.py" and "compute_plot_avg_error.py" to conduct the sensitivty analysis. 

